# Архитектура (`task03-bots`)
## `bot.py`
Класс `Bot` является абстрактым классом, от которого наследуются все остальные боты.
Бот должен уметь обрабатывать входящие сообщения.
Для обработки очередного сообщения вызывается метод `handle_message`.
Ответное сообщение (или несколько) отправляется через вызовы функции `send_message`.
Эта функция передаётся боту в конструкторе.

Если различные пользователи бота никак не взаимодействуют, то внутренняя логика бота
может быть реализована с помощью специальных обработчиков пользователей, наследуемых от `UserHandler`.
Бот передаёт такому обработчику сообщение через метод `handle_message`, а обработчик
может посылать ответные сообщения через функцию `send_message`, переданную ботом в
конструтор обработчика.

Стоит отметить, что несмотря на одинаковые названия, методы и функции в боте и
обработчике пользователя — разные.

В качестве примера совместной работы бота и обработчика рассмотрим класс `UserIndependentBot`.
Как параметр конструктора класс `UserIndependentBot` получает класс-обработчик.
Для каждого пользователя бот создаёт отдельный экземпляр обработчика.
При получении сообщения бот передаёт его дальше соответсвующему обработчику.
Обработчик же отправляет результат через функцию `send_message`, в которую бот "зашил" информацию о
том, какому пользователю отправляется результат.

## Пример работы `cli_multiple.py`
1. `./cli_multiple.py` запускается и создаёт один экземпляр `ChatBot` в переменной `bot`.
   В качестве `send_message` передаётся функция `send_message` из `cli_multiple.py`.
   Конструктор `ChatBot` создаёт исходно пустой список `bot.users = []`.
1. Пользователь вводит команду `10 hello`, которая интерпретируется
   скриптом как "пользователь 10 послал сообщение `hello`".
1. Вызывается `bot.handle_message(10, 'hello')`.
1. `handle_message` запоминает новый номер пользователя в список, теперь `bot.users == [10]`.
1. `handle_message` проходит циклом по всем элементам `bot.users` и вызывает
   `bot.send_message(10, 'hello')`, что ссылается на `send_message` из `cli_multiple.py`.
1. `send_message(10, 'hello')` из файла `cli_multiple.py` выводит на экран сообщение.
1. `handle_message` завершается, управление возвращается обратно в `cli_multiple.py`
   и скрипт ждёт следующей итерации.

